# Conan build pipeline
name: demo-led-status-indication build pipeline
pool:
  name: AZP-006_Raspberrypi_tool

steps:
- script: |
    pwd
    conan config install conanconfig
    conan remote list
    conan user
    conan create . swf/latest --build=demo-led-status-indication -pr=swf_ubuntu16_x64_gcc5
#    conan create . swf/latest --build=demo-led-status-indication -pr=swf_linux_to_arm_raspi
  displayName: 'Building via Conan'


- script: |
    ls '$(System.DefaultWorkingDirectory)/test_package'
  displayName: 'listing working directories'
- script: |
        cd test/build/CMakeFiles/gtestbin.dir
        gcov main.gcno
        lcov --capture --directory . --output-file LCOVOUTPUT.info
        genhtml LCOVOUTPUT.info --output-directory CODE_COVERAGE
  displayName: 'Running Lcov Gcov!'  

- script: |
        ls $(System.DefaultWorkingDirectory)/CODE_COVERAGE
  displayName: 'opening code coverage report'

- task: PublishCodeCoverageResults@1
  inputs:
    codeCoverageTool: 'JaCoCo'
    summaryFileLocation: '$(System.DefaultWorkingDirectory)/CODE_COVERAGE/usr/include/c++/5/ext/**'
    pathToSources: '$(System.DefaultWorkingDirectory)/coverager_results/usr/include/c++/5/ext'
    reportDirectory: '$(System.DefaultWorkingDirectory)/coverager_results/usr/include/c++/5/ext'
  displayName: 'publish code coverage report'
  



  